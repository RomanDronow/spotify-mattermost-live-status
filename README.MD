# Spotify Matters üéµ

Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–∞—à —Å—Ç–∞—Ç—É—Å –≤ Mattermost –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ –∏–∑ Spotify. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ –≤–∫—É—Å–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üéß **–ñ–∏–≤–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ Spotify**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–∫—É—â–∏—Ö —Ç—Ä–µ–∫–æ–≤ –∏–∑ Spotify
- üí¨ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Mattermost**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ Mattermost –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç—Ä–µ–∫–æ–≤
- üéØ **–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Å–º–µ–Ω–µ —Ç—Ä–µ–∫–∞
- üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Spotify OAuth —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å:

- Node.js (–≤–µ—Ä—Å–∏—è 14 –∏–ª–∏ –≤—ã—à–µ)
- –ê–∫–∫–∞—É–Ω—Ç Spotify
- –°–µ—Ä–≤–µ—Ä Mattermost —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ API
- ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <url-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
cd spotify-matters
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Spotify API

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à redirect URI –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö URIs (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://–≤–∞—à-—Ç—É–Ω–Ω–µ–ª—å.ngrok-free.app/callback`)
4. –ó–∞–ø–∏—à–∏—Ç–µ –≤–∞—à `Client ID` –∏ `Client Secret`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mattermost API

1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –≤ –≤–∞—à–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ Mattermost
2. –ó–∞–ø–∏—à–∏—Ç–µ –≤–∞—à `User ID` (–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spotify
SPOTIFY_CLIENT_ID=–≤–∞—à_spotify_client_id
SPOTIFY_CLIENT_SECRET=–≤–∞—à_spotify_client_secret
SPOTIFY_REFRESH_TOKEN=–≤–∞—à_refresh_token
REDIRECT_URI=https://–≤–∞—à-ngrok-—Ç—É–Ω–Ω–µ–ª—å.ngrok-free.app/callback

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Mattermost
MATTERMOST_SERVER_URL=https://–≤–∞—à-mattermost-—Å–µ—Ä–≤–µ—Ä.com
MATTERMOST_USER_ID=–≤–∞—à_user_id
MATTERMOST_TOKEN=–≤–∞—à_–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π_—Ç–æ–∫–µ–Ω_–¥–æ—Å—Ç—É–ø–∞
```

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ Spotify Refresh Token

**–í–∞–∂–Ω–æ**: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω ngrok —Ç—É–Ω–Ω–µ–ª—å –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `REDIRECT_URI` –≤ `.env` —Ñ–∞–π–ª–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL.

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è refresh —Ç–æ–∫–µ–Ω–∞:

```bash
node get-token.js
```

–≠—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç:

- –ó–∞–ø—É—Å—Ç–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8888
- –û—Ç–∫—Ä–æ–µ—Ç –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Spotify
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç refresh —Ç–æ–∫–µ–Ω
- –û—Ç–æ–±—Ä–∞–∑–∏—Ç —Ç–æ–∫–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ –±—Ä–∞—É–∑–µ—Ä–µ

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ refresh —Ç–æ–∫–µ–Ω –≤ –≤–∞—à —Ñ–∞–π–ª `.env`.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –∂–∏–≤–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

```bash
node live-status.js
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç:

- –ü–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ Spotify API –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à refresh —Ç–æ–∫–µ–Ω
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ —Ç—Ä–µ–∫–∏
- –û–±–Ω–æ–≤–ª—è—Ç—å –≤–∞—à —Å—Ç–∞—Ç—É—Å –≤ Mattermost –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç—Ä–µ–∫–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –§–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç—É—Å–∞

- **–ò–≥—Ä–∞–µ—Ç**: `–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ ‚Äì –ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è`
- **–ù–µ –∏–≥—Ä–∞–µ—Ç**: `‚èπ –ù–µ –∏–≥—Ä–∞–µ—Ç`

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Spotify OAuth —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–µ–∫–æ–≤**: –û–ø—Ä–∞—à–∏–≤–∞–µ—Ç Spotify API –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PUT –∑–∞–ø—Ä–æ—Å—ã –∫ Mattermost API –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
4. **–£–º–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Å–º–µ–Ω–µ —Ç—Ä–µ–∫–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–ø–∞–º–∞

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ API endpoints

### Spotify API

- `GET /v1/me/player/currently-playing` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ
- `POST /api/token` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–æ–≤

### Mattermost API

- `PUT /api/v4/users/{user_id}/status/custom` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –¥–ª—è:

- –ü—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç–µ–≤—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –õ–∏–º–∏—Ç–æ–≤ API
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `axios` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- `dotenv` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `express` - –í–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è OAuth –ø–æ—Ç–æ–∫–∞

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π refresh token"**

   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `node get-token.js` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ refresh —Ç–æ–∫–µ–Ω–∞

2. **"Unauthorized" –æ—à–∏–±–∫–∏ Mattermost**

   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∏ user ID
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

3. **"–ù–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è"**

   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Spotify –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –º—É–∑—ã–∫—É
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç Spotify –∞–∫—Ç–∏–≤–µ–Ω

4. **"–û—à–∏–±–∫–∞ redirect URI"**

   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `REDIRECT_URI` –≤ `.env` —Ñ–∞–π–ª–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å URI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Spotify –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ngrok —Ç—É–Ω–Ω–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–∑–º–µ–Ω–∏–≤ console.log –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ `live-status.js`.

## –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ pull request

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC License - —Å–º. package.json –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫ –≤—ã—à–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
